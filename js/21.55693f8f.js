(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{fac0:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("div",{staticClass:"row q-col-gutter-sm q-ma-xs q-mr-sm"},[a("div",{staticClass:"col-lg-12 col-md-12 col-sm-12 col-xs-12"},[a("q-card",{attrs:{flat:"",bordered:""}},[a("q-card-section",[a("q-table",{attrs:{title:"รายละเอียดผู้เข้าจอด",data:t.allagenttables,flat:"","hide-header":"grid"===t.mode,columns:t.columnsagenttable,"row-key":"Agentid",grid:"grid"==t.mode,pagination:t.pagination,loading:t.loadgingagenttables},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"top-right",fn:function(e){return[a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"refresh"},on:{click:function(e){t.filter="",t.Search()}}},[a("q-tooltip",{directives:[{name:"close-popup",rawName:"v-close-popup"}]},[t._v("รีโหลด")])],1),a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"add"},on:{click:function(e){t.modeadd=!0,t.currentagenttable=null,t.dialoginfo=!0}}},[a("q-tooltip",{directives:[{name:"close-popup",rawName:"v-close-popup"}]},[t._v("เพิ่ม")])],1),a("q-input",{attrs:{outlined:"",dense:""},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.Search()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{attrs:{flat:"",round:"","text-color":"purple",icon:"credit_card"},on:{click:t.ReadSmartCardReader}})]},proxy:!0}],null,!0),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[a("q-tooltip",[t._v("รหัส/ปชช./ชื่อ/เบอร์ Enter")])],1),e.inFullscreen?t._e():a("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"grid"===t.mode?"list":"grid_on"},on:{click:function(e){t.mode="grid"===t.mode?"list":"grid",t.separator="grid"===t.mode?"none":"horizontal"}}},[a("q-tooltip",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{disable:t.$q.platform.is.mobile}},[t._v(t._s("grid"===t.mode?"List":"Grid"))])],1)]}},{key:"body-cell-Menu",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("q-btn",{attrs:{dense:"",flat:"",color:"green",icon:"menu"}},[a("q-menu",{attrs:{"transition-show":"jump-down","transition-hide":"jump-up"}},[a("q-list",{staticStyle:{"min-width":"100px"}},[a("q-item",{attrs:{clickable:"",disable:1!==e.row.Status},on:{click:function(a){return t.Confirminfoagenttables(e.row)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"primary",name:"note_add"}})],1),a("q-item-section",[t._v("ยืนยันตัวตน")])],1),a("q-item",{attrs:{clickable:"",disable:2!==e.row.Status||1===e.row.Bonus},on:{click:function(a){return t.Bonusstartagenttables(e.row)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"primary",name:"note_add"}})],1),a("q-item-section",[t._v("เริ่มต้นโบนัส")])],1),a("q-separator"),a("q-item",{attrs:{clickable:"",disable:1!==e.row.Status},on:{click:function(a){return t.Deleteagenttables(e.row)}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{color:"red",name:"delete"}})],1),a("q-item-section",[t._v("ลบ")])],1)],1)],1)],1)],1)]}},{key:"body-cell-Action",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("div",[a("q-btn",{attrs:{dense:"",flat:"",outline:"",color:"info",icon:"edit"},on:{click:function(a){t.currentagenttable=e.row,t.modeadd=!1,t.dialoginfo=!0}}})],1)])]}},{key:"body-cell-Status",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("q-badge",{attrs:{color:t.COLOR[e.row.Status]}},[t._v("\n                  "+t._s(t.STATUS[e.row.Status])+"\n                ")])],1)]}},{key:"body-cell-Identitynumber",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n                "+t._s(e.row.Identitynumber)+"\n              ")])]}},{key:"body-cell-Agenttypeid",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("q-badge",{attrs:{color:t.COLOR[e.row.Agenttypeid]}},[t._v("\n                  "+t._s(t.optionagenttype.find((function(t){return t.Agenttypeid===e.row.Agenttypeid}))?t.optionagenttype.find((function(t){return t.Agenttypeid===e.row.Agenttypeid})).Name:"")+"\n                ")])],1)]}},{key:"body-cell-Bonus",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("q-btn",{attrs:{round:"",flat:"",dense:"",size:"xs"}},[a("q-icon",{attrs:{name:1===t.row.Bonus?"check":"clear",color:1===t.row.Bonus?"green":"red"}})],1)],1)]}},{key:"body-cell-Modifiedby",fn:function(e){return[a("q-td",{attrs:{props:e}},[t._v("\n                "+t._s(t.alluser.find((function(t){return t.Id===e.row.Modifiedby}))?t.alluser.find((function(t){return t.Id===e.row.Modifiedby})).UserName:"")+"\n              ")])]}},{key:"pagination",fn:function(){return[a("div",[a("q-pagination",{attrs:{size:"sm",color:"black",max:t.pagination.MaxPage,"max-pages":4,"boundary-numbers":!1},model:{value:t.pagination.Page,callback:function(e){t.$set(t.pagination,"Page",e)},expression:"pagination.Page"}})],1)]},proxy:!0}])})],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.dialoginfo,callback:function(e){t.dialoginfo=e},expression:"dialoginfo"}},[a("div",{staticStyle:{"max-width":"100%",width:"80%"}},[a("addagent",{attrs:{agenttable:t.currentagenttable,modeadd:t.modeadd,alluser:t.alluser},on:{added:t.Added,updated:t.Updated}})],1)])],1)])},i=[],o=(a("456d"),a("8a81"),a("9986"),a("8e6e"),a("448a")),r=a.n(o),l=a("c973"),s=a.n(l),d=a("9523"),c=a.n(d),g=a("a34a"),u=a.n(g),f=(a("d25f"),a("6d67"),a("097d"),a("06db"),a("551c"),a("20d6"),a("f751"),a("bd4c")),p=a("2f62");function b(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?b(Object(a),!0).forEach((function(e){c()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var h={1:"เปิดค้างไว้",2:"ยืนยันตัวตนแล้ว"},y={0:"negative",1:"warning",2:"green",3:"info",4:"primary"},q={name:"Agenttable",components:{addagent:a("86f5").default},data:function(){return{date:f["b"],STATUS:h,COLOR:y,dialoginfo:!1,modeadd:!0,mode:"list",pagination:{Page:1,MaxPage:1,page:1,rowsPerPage:10},filter:"",loadgingagenttables:!1,allagenttables:[],currentagenttable:null,columnsagenttable:[{name:"Menu",label:"",align:"center",field:"Menu"},{name:"Action",label:"",align:"center",field:"Action"},{name:"Status",label:"สถานะ",align:"center",field:"Status"},{name:"Agentid",label:"รหัสผู้เข้าจอด",align:"left",field:"Agentid",sortable:!0,headerClasses:"bg-primary text-white",classes:"bg-grey-2 ellipsis"},{name:"Identitynumber",label:"เลขที่ ปชช.",align:"left",field:"Identitynumber",sortable:!0,classes:"bg-grey-2 ellipsis"},{name:"Phone",label:"โทร",align:"left",field:"Phone",sortable:!0},{name:"Name",label:"ชื่อ",align:"left",field:"Name",sortable:!0},{name:"Alias",label:"ชื่อเรียก",align:"left",field:"Alias",sortable:!0},{name:"Bonus",label:"โบนัส",align:"center",field:"Bonus",sortable:!0},{name:"Sumamount",label:"ยอดสะสม",align:"left",field:"Sumamount",sortable:!0,classes:"bg-grey-2 ellipsis"},{name:"Agenttypeid",label:"ประเภท",align:"right",field:"Agenttypeid",sortable:!0,headerClasses:"bg-primary text-white"},{name:"Remark",label:"หมายเหตุ",align:"center",field:"Remark",sortable:!0}],optionagenttype:[],alluser:[]}},created:function(){var t=this;this.$route.query.birthday?(this.loadgingagenttables=!0,this.getagenttablesbirthday().then((function(e){var a=e.data;t.MapData(a)}))):this.LoadData(this.pagination),this.getagenttypes().then((function(e){var a=e.data;t.optionagenttype=a}))},methods:m(m(m({},Object(p["b"])("retailarea",["getagenttablespagination","getagenttypes","deleteagenttables","confirminfoagenttables","bonusstartagenttables","getagenttablesbirthday"])),Object(p["b"])("auth",["getuserinid"])),{},{LoadData:function(t){var e=this;this.loadgingagenttables=!0,this.getagenttablespagination({page:t.Page,rowperpage:t.rowsPerPage,search:this.filter}).then((function(t){var a=t.data;e.MapData(a)}))},MapData:function(t){var e=this;return s()(u.a.mark((function a(){var n;return u.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.pagination.MaxPage=t.MaxPage,e.allagenttables=t.Data,n=[].concat(r()(e.allagenttables.map((function(t){return t.Createdby}))),r()(e.allagenttables.map((function(t){return t.Modifiedby}))),r()(e.allagenttables.map((function(t){return t.Confirminfoby}))),r()(e.allagenttables.map((function(t){return t.Bonusstartby}))),r()(e.allagenttables.map((function(t){return t.Bonusrestartby}))),r()(e.allagenttables.map((function(t){return t.Sumamountlasttime})))),e.getuserinid({data:n}).then((function(t){var a=t.data;e.alluser=a})).catch((function(t){e.$q.notify(t.message)})).finally((function(){e.loadgingagenttables=!1}));case 4:case"end":return a.stop()}}),a)})))()},Deleteagenttables:function(t){var e=this;this.$q.dialog({dark:!0,title:"ยืนยัน",message:"แน่ใจว่าต้องการลบบรรทัด ?",cancel:!0,persistent:!0}).onOk((function(){e.$q.loading.show(),e.deleteagenttables(t).then((function(t){var a=t.data;e.allagenttables.splice(e.allagenttables.findIndex((function(t){return t.Agentid===a.Agentid})),1),e.$q.notify("อัพเดทเรียบร้อย"),e.$q.loading.hide(),e.timer=void 0})).catch((function(t){e.$q.loading.hide(),e.timer=void 0,console.log(t.response),e.$q.notify({icon:"done",color:"red",message:t.response.data.message})}))}))},Confirminfoagenttables:function(t){var e=this;this.$q.loading.show(),this.confirminfoagenttables(t).then((function(t){t.status;var a=t.data,n=e.allagenttables.findIndex((function(t){return t.Agentid===a.Agentid}));e.allagenttables[n]=Object.assign(e.allagenttables[n],a),e.$q.notify("อัพเดทเรียบร้อย"),e.$q.loading.hide(),e.timer=void 0})).catch((function(t){e.$q.loading.hide(),e.timer=void 0,console.log(t.response),e.$q.notify({icon:"done",color:"red",message:t.response.data.message})}))},Bonusstartagenttables:function(t){var e=this;this.$q.loading.show(),this.bonusstartagenttables(t).then((function(t){t.status;var a=t.data,n=e.allagenttables.findIndex((function(t){return t.Agentid===a.Agentid}));e.allagenttables[n]=Object.assign(e.allagenttables[n],a),e.$q.notify("อัพเดทเรียบร้อย"),e.$q.loading.hide(),e.timer=void 0})).catch((function(t){e.$q.loading.hide(),e.timer=void 0,console.log(t.response),e.$q.notify({icon:"done",color:"red",message:t.response.data.message})}))},Search:function(){1===this.pagination.Page?this.LoadData(this.pagination):this.pagination.Page=1},Added:function(t){this.allagenttables.unshift(t),this.dialoginfo=!1},Updated:function(t){var e=this.allagenttables.findIndex((function(e){return e.Agentid===t.Agentid}));this.allagenttables[e]=Object.assign(this.allagenttables[e],t),this.dialoginfo=!1},ReadSmartCardReader:function(){var t=this,e=a("30dc"),n={method:"GET",url:"http://localhost:8888/readthaiidentity"};this.$q.loading.show(),e(n,(function(e,a){if(t.$q.loading.hide(),t.timer=void 0,e||200!==a.statusCode)t.$q.notify("ตรวจสอบเครื่องอ่านบัตร");else{var n=JSON.parse(a.body);t.filter=n.Citizenid,t.Search()}}))}}),beforeDestroy:function(){void 0!==this.timer&&(clearTimeout(this.timer),this.$q.loading.hide())},watch:{"pagination.Page":function(t,e){this.LoadData(this.pagination)},"pagination.rowsPerPage":function(){1===this.pagination.Page?this.LoadData(this.pagination):this.pagination.Page=1}}},v=q,w=a("2877"),k=a("9989"),P=a("f09f"),O=a("a370"),S=a("eaac"),A=a("9c40"),x=a("05c0"),_=a("27f9"),$=a("db86"),j=a("4e73"),C=a("1c1c"),D=a("66e5"),Q=a("4074"),M=a("0016"),I=a("eb85"),B=a("58a8"),L=a("3b16"),R=a("24e8"),T=a("7f67"),N=a("eebe"),E=a.n(N),U=Object(w["a"])(v,n,i,!1,null,null,null);e["default"]=U.exports;E()(U,"components",{QPage:k["a"],QCard:P["a"],QCardSection:O["a"],QTable:S["a"],QBtn:A["a"],QTooltip:x["a"],QInput:_["a"],QTd:$["a"],QMenu:j["a"],QList:C["a"],QItem:D["a"],QItemSection:Q["a"],QIcon:M["a"],QSeparator:I["a"],QBadge:B["a"],QPagination:L["a"],QDialog:R["a"]}),E()(U,"directives",{ClosePopup:T["a"]})}}]);